<div class="card shadow-sm border-1 rounded-3 p-3 mb-3"
   style="transition: transform 0.2s, box-shadow 0.2s;"
     onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 15px rgba(0,0,0,0.15)';"
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='';">
  <div class="card-body">
    <div class="d-flex justify-content-between mb-2">
      <strong>{{ comment.author.username }}</strong>
      {% if request.user.is_authenticated and request.user == comment.author %}
        <div class="d-flex justify-content-end gap-3">
            <a href="{% url 'comment_update' comment_id=comment.pk %}" class="text-primary fs-5" title="Edit comment">
                <i class="bi bi-pencil-square"></i>
            </a>
            <a href="{% url 'comment_delete' comment_id=comment.pk %}" class="text-danger fs-5" title="Delete comment">
                <i class="bi bi-trash"></i>
            </a>
        </div>
      {% endif %}
      
    </div>

    <p class="mb-3">{{ comment.content }}</p>

    <div class="d-flex gap-2 align-items-center">
      <button class="btn btn-outline-success btn-sm" data-type="1" data-id="{{ comment.id }}">
        <i class="bi bi-hand-thumbs-up"></i> ({{ comment.upvotes }})
      </button>
      <button class="btn btn-outline-danger btn-sm" data-type="-1" data-id="{{ comment.id }}">
        <i class="bi bi-hand-thumbs-down"></i> ({{ comment.downvotes }})
      </button>

      {% if comment.replies_cached %}
        <button class="btn btn-link btn-sm text-decoration-none toggle-replies" data-reply-count="{{ comment.replies_cached|length }}">
          View Replies ({{ comment.replies_cached|length }})
        </button>
      {% endif %}
    </div>

    <div class="reply-form-container mt-3 d-none">
      <form class="reply-form" method="post" data-parent-id="{{ comment.id }}">
        {% csrf_token %}
        <textarea 
          name="content" 
          rows="2" 
          class="form-control mb-2" 
          placeholder="Write a reply..." 
          required></textarea>
    
    
        <input type="hidden" name="parent" value="{{ comment.id }}">
    
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm cancel-reply">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary btn-sm">
            Post Reply
          </button>
        </div>
      </form>
    </div>



    {% if user.is_authenticated %}
      <div class="d-flex justify-content-end mt-3">
        <button type="button" class="btn btn-outline-primary btn-sm reply-btn">
          <i class="bi bi-reply me-1"></i> Reply
        </button>
      </div>
    {% endif %}

    {% if comment.replies_cached %}
      <div class="replies mt-3 ps-4 border-start d-none">
        {% for reply in comment.replies_cached %}
          {% include "forum/_comment_card.html" with comment=reply %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>
