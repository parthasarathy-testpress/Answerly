{% load humanize widget_tweaks vote_tags %}

<hr class="my-4">
<h4 class="mt-4 mb-3">Comments ({{ paginator.count }})</h4>
<div class="card shadow-sm border-0 rounded-3 mb-4">
  <div class="card-body">
    <form id="comment-form" method="post" action="{% url 'answer_detail' answer.pk %}">
      {% csrf_token %}
      <div>
        <textarea
          name="content"
          id="id_content"
          class="form-control mb-3"
          rows="4"
          placeholder="Add a public comment..."
          required
          style="resize: vertical;"
        ></textarea>
        <div class="d-flex justify-content-end gap-2">
          <button type="reset" class="btn btn-outline-danger btn-sm">Clear</button>
          <button type="submit" class="btn btn-primary btn-sm">Comment</button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="mb-3">
  <form method="get" class="d-flex align-items-center gap-2" id="comment-filter-form">
    <div class="ms-auto">
      <select 
        name="{{ filter.form.vote_type.name }}" 
        id="{{ filter.form.vote_type.id_for_label }}"
        class="form-select form-select-sm w-auto"
        hx-get="{{ request.path }}"
        hx-target="#comment-list"
        hx-swap="innerHTML"
        hx-trigger="change"
        hx-include="#comment-filter-form"
        hx-push-url="false">
        {% for choice in filter.form.vote_type.field.choices %}
          <option value="{{ choice.0 }}" {% if filter.form.vote_type.value == choice.0|stringformat:"s" %}selected{% endif %}>
            {{ choice.1 }}
          </option>
        {% endfor %}
      </select>
    </div>
    {% if filter.form.vote_type.value %}
      <a href="{{ request.path }}" 
         class="btn btn-outline-secondary btn-sm"
         hx-get="{{ request.path }}"
         hx-target="#comment-list"
         hx-swap="innerHTML"
         hx-push-url="false">
        Clear
      </a>
    {% endif %}
  </form>
</div>

{% for comment in comments %}
  {% include "forum/_comment_card.html" with comment=comment %}
{% empty %}
  <p class="text-muted fst-italic">No comments yet.</p>
{% endfor %}

{% include "_pagination.html" %}
